# Redirect ssl
server {
    listen 80;
    server_name matterapp.local *.matterapp.local;
     #Rewrite all nonssl requests to ssl.
    return 301 https://$host$request_uri;
}

# Redirect marketing
server {
    listen 443 ssl;
    server_name matterapp.local;
    return 301 https://www.$host$request_uri;
}

# Marketing
server {
    listen  80;
    listen 443 default_server ssl;
    server_name www.matterapp.local;
    ssl on;
    ssl_certificate /home/certs/matter.crt;
    ssl_certificate_key /home/certs/matter.key;

    access_log  /var/log/nginx/marketing.access.log;
    error_log  /var/log/nginx/marketing.error.log;

    location / {
        proxy_pass  http://matter-marketing;
        include /etc/nginx/conf.d/proxy_config;
    }
}

# Matter-client
server {
    listen 443 ssl;
    server_name app.matterapp.local;
    ssl on;
    ssl_certificate /home/certs/matter.crt;
    ssl_certificate_key /home/certs/matter.key;

    access_log  /var/log/nginx/client.access.log;
    error_log  /var/log/nginx/client.error.log;

    location / {
        proxy_pass  http://matter-client;
        include /etc/nginx/conf.d/proxy_config;
    }
}
